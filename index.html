<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Firebase SDK v8 -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <!-- TweetNaCl for encryption (public key cryptography) -->
  <script src="https://cdn.jsdelivr.net/npm/tweetnacl@1.0.3/nacl.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tweetnacl-util@0.15.1/nacl-util.min.js"></script>

  <title>Promise Voucher Network</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <!-- ===== AUTHENTICATION SCREEN ===== -->
  <div id="authScreen" class="auth-screen">
    <div class="auth-container">
      <h1>Promise Voucher Network</h1>

      <!-- Login/Signup Tabs -->
      <div class="auth-tabs">
        <button id="loginTab" class="auth-tab active" data-mode="login">Login</button>
        <button id="signupTab" class="auth-tab" data-mode="signup">Sign Up</button>
      </div>

      <!-- Login Form -->
      <form id="loginForm" class="auth-form active">
        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" id="loginEmail" class="form-control" required>
        </div>
        <div class="form-group">
          <label class="form-label">Password</label>
          <input type="password" id="loginPassword" class="form-control" required>
        </div>
        <button type="submit" class="btn btn--primary btn--full-width">Login</button>
        <div id="loginError" class="auth-error"></div>
      </form>

      <!-- Signup Form -->
      <form id="signupForm" class="auth-form">
        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" id="signupEmail" class="form-control" required>
        </div>
        <div class="form-group">
          <label class="form-label">Password (min 6 characters)</label>
          <input type="password" id="signupPassword" class="form-control" required>
        </div>
        <button type="submit" class="btn btn--primary btn--full-width">Sign Up</button>
        <div id="signupError" class="auth-error"></div>
      </form>
    </div>
  </div>

  <!-- ===== MAIN APP CONTAINER ===== -->
        <div id="appContainer" class="app-container hidden">
          <!-- App Layout: Sidebar + Main Content -->
          <div class="app-layout">
              <!-- Sidebar Navigation -->
              <aside class="app-sidebar">
                  <div class="sidebar-header">
                      <h2>Promise</h2>
                      <p class="sidebar-subtitle">Voucher Network</p>
                  </div>

                  <nav class="sidebar-nav">
                      <button class="nav-item active" data-tab="dashboard">
                          <span class="nav-icon">üìä</span>
                          <span>Dashboard</span>
                      </button>
                      <button class="nav-item" data-tab="inbox">
                          <span class="nav-icon">üì•</span>
                          <span>Inbox</span>
                          <span class="badge" id="inboxBadge"></span>
                      </button>
                      <button class="nav-item" data-tab="outbox">
                          <span class="nav-icon">üì§</span>
                          <span>Outbox</span>
                          <span class="badge" id="outboxBadge"></span>
                      </button>
                      <button class="nav-item" data-tab="contacts">
                          <span class="nav-icon">üë•</span>
                          <span>Network</span>
                          <span class="badge" id="networkBadge"></span>
                      </button>
                        <div class="nav-item" data-tab="transfer">
                        <span class="nav-icon">üì§</span>
                        <span class="nav-label">Transfer</span>
                        </div>
                  </nav>

                  <div class="sidebar-footer">
                      <div class="user-card">
                          <div class="user-email" id="currentAgentKey"></div>
                          <button id="logoutBtn" class="btn btn--sm btn--secondary btn--full-width">Logout</button>
                      </div>
                  </div>
              </aside>

              <!-- Main Content Area -->
              <main class="app-main">
                  <!-- FAB Button for Creating Promises -->
                  <button id="createPromiseFAB" class="fab-button" title="Create New Promise">
                      <span>‚ûï</span>
                  </button>

                  <!-- Tab Content -->
                  <div class="tab-content">
                      <!-- Dashboard Tab -->
                      <div id="dashboard" class="tab-pane active">
                          <div class="dashboard-header">
                              <h2>Dashboard</h2>
                              <p>Overview of your promise network</p>
                          </div>

                          <!-- Key Stats Grid -->
                          <div class="stats-grid">
                              <div class="stat-card">
                                  <div class="stat-icon">üìä</div>
                                  <div class="stat-content">
                                      <div class="stat-label">Total Promises</div>
                                      <div class="stat-value" id="totalPromises">0</div>
                                  </div>
                              </div>
                              <div class="stat-card">
                                  <div class="stat-icon">‚ú®</div>
                                  <div class="stat-content">
                                      <div class="stat-label">Active Promises</div>
                                      <div class="stat-value" id="activePromises">0</div>
                                  </div>
                              </div>
                              <div class="stat-card">
                                  <div class="stat-icon">‚úÖ</div>
                                  <div class="stat-content">
                                      <div class="stat-label">Redeemed</div>
                                      <div class="stat-value" id="redeemedPromises">0</div>
                                  </div>
                              </div>
                              <div class="stat-card">
                                  <div class="stat-icon">ü§ù</div>
                                  <div class="stat-content">
                                      <div class="stat-label">Connections</div>
                                      <div class="stat-value" id="networkAgents">0</div>
                                  </div>
                              </div>
                          </div>

                          <!-- Quick Actions -->
                          <div class="quick-actions">
                              <h3>Quick Actions</h3>
                              <div class="action-buttons">
                                  <button id="quickCreateBtn" class="btn btn--primary">Create Promise</button>
                                  <button id="quickViewInboxBtn" class="btn btn--secondary">View Inbox</button>
                              </div>
                          </div>

                          <!-- Recent Activity -->
                          <div class="recent-activity">
                              <h3>Recent Activity</h3>
                              <div class="activity-log" id="activityLog">
                                  No recent activity
                              </div>
                          </div>
                      </div>

                      <!-- Inbox Tab -->
                      <div id="inbox" class="tab-pane">
                          <div class="content-header">
                              <h2>Your Inbox</h2>
                              <p>Promises sent to you</p>
                          </div>

                          <div class="promise-filters">
                              <button class="filter-btn active" data-filter="all">All</button>
                              <button class="filter-btn" data-filter="active">Active</button>
                              <button class="filter-btn" data-filter="redeemed">Redeemed</button>
                          </div>

                          <div class="promises-container" id="inboxPromises">
                              <div class="empty-state">
                                  <p>üì• No promises received yet</p>
                                  <small>Promises sent to you will appear here</small>
                              </div>
                          </div>
                      </div>

                      <!-- Outbox Tab -->
                      <div id="outbox" class="tab-pane">
                          <div class="content-header">
                              <h2>Your Outbox</h2>
                              <p>Promises you've sent</p>
                          </div>

                          <div class="promise-filters">
                              <button class="filter-btn active" data-filter="all">All</button>
                              <button class="filter-btn" data-filter="active">Active</button>
                              <button class="filter-btn" data-filter="redeemed">Redeemed</button>
                          </div>

                          <div class="promises-container" id="outboxPromises">
                              <div class="empty-state">
                                  <p>üì§ No promises sent yet</p>
                                  <small>Create your first promise to get started</small>
                              </div>
                          </div>
                      </div>

                      <!-- Create Promise Tab -->
                      <div id="create" class="tab-pane">
                          <div class="content-header">
                              <h2>Create New Promise</h2>
                              <p>Make a commitment to someone</p>
                          </div>

                          <form id="createPromiseForm" class="form create-form">
                              <div class="form-group">
                                  <label class="form-label" for="promiseContent">What are you promising? *</label>
                                  <textarea id="promiseContent" class="form-control" placeholder="e.g., 'Help with moving', 'Free dinner', 'Advice on...'..." required></textarea>
                              </div>

                              <div class="form-group">
                                  <label class="form-label" for="promiseReceiver">Send to *</label>
                                  <select id="promiseReceiver" class="form-control">
                                      <option value="">Select a contact...</option>
                                  </select>
                              </div>

                              <div class="form-row">
                                  <div class="form-group">
                                      <label class="form-label" for="promiseQuantity">Quantity</label>
                                      <input type="number" id="promiseQuantity" class="form-control" min="1" max="1000" value="1" required>
                                  </div>

                                  <div class="form-group">
                                      <label class="form-label" for="promiseExpiration">Expires</label>
                                      <input type="date" id="promiseExpiration" class="form-control">
                                  </div>
                              </div>

                              <div class="form-group">
                                  <label class="checkbox-label">
                                      <input type="checkbox" id="promiseLock">
                                      <span>Lock this promise (cannot be transferred)</span>
                                  </label>
                              </div>

                              <button type="submit" class="btn btn--primary btn--full-width">Create Promise</button>
                          </form>
                      </div>

                      <!-- Transfer Promise Tab -->
                        <div id="transfer" class="tab-pane">
                          <h2>Transfer Promise</h2>
                          <p class="tab-description">Give your promise to someone else</p>

                          <form id="transferPromiseForm" class="form">
                            <div class="form-group">
                              <label for="transferPromiseSelect" class="form-label">Select Promise to Transfer</label>
                              <select id="transferPromiseSelect" class="form-control" required>
                                <option value="">-- Select a promise to transfer --</option>
                              </select>
                              <div id="transferPreview" class="preview-box"></div>
                            </div>

                            <div class="form-group">
                              <label for="transferReceiver" class="form-label">Transfer To</label>
                              <select id="transferReceiver" class="form-control" required>
                                <option value="">-- Select a contact --</option>
                              </select>
                            </div>

                            <button type="submit" class="btn btn-primary btn-block">Transfer Promise</button>
                          </form>
                        </div>



                      <!-- Network (Contacts) Tab -->
                      <div id="contacts" class="tab-pane">
                          <div class="content-header">
                              <h2>Your Network</h2>
                              <p>Manage your connections</p>
                          </div>

                          <form id="addContactForm" class="form add-contact-form">
                              <div class="form-group">
                                  <label class="form-label" for="contactName">Add New Connection</label>
                                  <div class="input-group">
                                      <input type="email" id="contactName" class="form-control" placeholder="user@example.com" required>
                                      <button type="submit" class="btn btn--primary">Add</button>
                                  </div>
                              </div>
                          </form>

                          <h3>Connections</h3>
                          <div class="contacts-list" id="contactsList">
                              No contacts yet. Start building your network!
                          </div>
                      </div>
                  </div>
              </main>
          </div>
      </div>

      </main>
    </div>
  </div>

  <!-- Toast Notifications -->
  <div class="toast-container" id="toastContainer"></div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
    <p>Loading...</p>
  </div>

  <!-- Firebase Configuration & Initialization -->
  <script>
    // Your web app's Firebase configuration
    var firebaseConfig = {
      apiKey: "AIzaSyBlz5MKpgcBfjjDa44V8TIhz09l0RsPaYE",
      authDomain: "promise-network-mvp.firebaseapp.com",
      projectId: "promise-network-mvp",
      storageBucket: "promise-network-mvp.firebasestorage.app",
      messagingSenderId: "508110234402",
      appId: "1:508110234402:web:769227fa0be87d543c7b7b",
      measurementId: "G-YQR0TT1S94"
    };

    // Initialize Firebase (v8 style)
    firebase.initializeApp(firebaseConfig);

    // We'll use these later in app.js
    var auth = firebase.auth();
    var db = firebase.firestore();

    // Debug: Check if services are ready
    console.log('Auth service:', auth);
    console.log('Firestore service:', db);
  </script>



  <!-- Your app logic -->
  <script src="app.js"></script>
</body>

</html>